<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>
</title>
<link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
<script>
	$( '#home' ).live( 'pageinit',function(event){
		$('#list').empty();
		$.getJSON("list.php/items", function(result){
			var items = {}, priorities = [];
			for (var i in result)
			{
				if (result.hasOwnProperty(i))
				{
					if ($.inArray(result[i].priority, priorities) === -1) priorities.push(result[i].priority);
					items["p" + result[i].priority] = (typeof items["p" + result[i].priority] !== "undefined") ? items["p" + result[i].priority] : [];
					items["p" + result[i].priority].push(result[i]);
				}
			}
			priorities.sort(function(a,b){return a-b});
			for (i in priorities)
			{
				if (priorities.hasOwnProperty(i))
				{
					$('#list').append('<li data-role="list-divider" role="heading">P' + priorities[i] + '</li>');
					for (var j in items["p" + priorities[i]])
					{
						$('#list').append('<li id="' + items["p" + priorities[i]][j]._id.$id + '" data-theme="c"><a href="#page2" data-transition="slide">' + items["p" + priorities[i]][j].name + '</a></li>');
					}
				}
			}
			$('#list').listview('refresh');
		});
	});
</script>
</head>
<body>
	<!-- Home -->
	<div data-role="page" id="home">
		<div data-theme="a" data-role="header">
			<h1>Shopping List</h1>
			<div data-role="fieldcontain">
				<select name="" data-theme="a">
					<option value="">All Priorities</option>
					<option value="2">P2 or P1</option>
					<option value="1">P1 Only</option>
				</select>
			</div>
		</div>
		<div data-role="content">
			<ul id="list" data-role="listview" data-divider-theme="b" data-inset="false">
			</ul>
		</div>
		<div data-theme="a" data-role="footer" data-position="fixed">
			<div data-role="navbar" data-iconpos="top">
				<ul>
					<li>
						<a href="#confirm" data-transition="pop" data-theme="" data-icon="delete" data-rel="dialog">Remove All</a>
					</li>
					<li>
						<a href="#page1" data-transition="fade" data-theme="" data-icon="plus">New Item</a>
					</li>
				</ul>
			</div>
		</div>
	</div>

	<!-- Test -->
	<div data-role="page" id="page2">
		<div data-theme="a" data-role="header">
			<h1>Test Page</h1>
		</div>
		<div data-role="content">
			<a href="#home" data-transition="slide" data-direction="reverse">Go Back</a>
		</div>
	</div>

	<!-- Confirm Dialog -->
	<div data-role="dialog" id="confirm">
		<div data-theme="a" data-role="header">
			<h1>Remove All Items?</h1>
		</div>
		<div data-role="content">
			<!-- <a href="#home" data-transition="pop" data-direction="reverse">Go Back</a> -->
			<h3>Are you sure that you want to remove all items from the list?</h3>
			<fieldset class="ui-grid-a">
				<div class="ui-block-a"><button type="submit" data-theme="c">Cancel</button></div>
				<div class="ui-block-b"><button type="submit" data-theme="b">Remove All Items</button></div>
			</fieldset>
		</div>
	</div>
</body>
</html>
